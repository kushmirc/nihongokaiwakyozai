jQuery(document).ready((function(t){"use strict";function e(t){return t.error!==undefined}var i=function(){function t(t,e){this.hash=t,this.name=e}return t.prototype.get=function(){var t=new RegExp("[?&]sgdg-"+this.name+"-"+this.hash+"=(([^&#]*)|&|#|$)").exec(document.location.search);return t&&t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):""},t.prototype.remove=function(){var t=window.location.search,e=new RegExp("\\?sgdg-"+this.name+"-"+this.hash+"=[^&]*"),i=new RegExp("&sgdg-"+this.name+"-"+this.hash+"=[^&]*");return t&&(t=(t=t.replace(e,"?")).replace(i,"")),window.location.pathname+t},t.prototype.add=function(t){var e=window.location.search,i="sgdg-"+this.name+"-"+this.hash+"="+t,a="?"+i,o=new RegExp("([?&])sgdg-"+this.name+"-"+this.hash+"=[^&]*");return t?(e&&(a=null!==o.exec(e)?e.replace(o,"$1"+i):e+"&"+i),window.location.pathname+a):this.remove()},t}(),a=require("justified-layout"),o=function(){function o(e,a){var o=this;this.lightbox=t(),this.hasMore=!1,this.path="",this.lastPage=1,this.loading=!1,this.container=t(e),this.hash=a,this.shortHash=a.substr(0,8),this.pageQueryParameter=new i(this.shortHash,"page"),this.pathQueryParameter=new i(this.shortHash,"path"),this.path=this.pathQueryParameter.get(),this.get(),t(window).on("popstate",(function(){return o.init()})),t(window).resize((function(){return o.reflow()}))}return o.prototype.onLightboxNavigation=function(e){var i=t(e).data("sgdg-page"),a=t(e).parent().children().length;history.replaceState(history.state,"",this.pageQueryParameter.add(i)),"true"===sgdgShortcodeLocalize.page_autoload&&this.hasMore&&t(e).index()>=Math.min(a-2,Math.floor(.9*a))&&this.add()},o.prototype.onLightboxQuit=function(){history.replaceState(history.state,"",this.pageQueryParameter.remove())},o.prototype.reflow=function(){var e=this,i=[],o=[];this.container.find(".sgdg-gallery").children().each((function(e,a){t(a).css("display","inline-block");var r=a.firstChild,n=r.naturalWidth/r.naturalHeight;if(0<t(a).find("svg").length){var s=t(a).find("svg")[0].getBBox();n=s.width/s.height}t(a).hasClass("sgdg-grid-square")&&(n=1),isNaN(n)?i[e]=!1:(i[e]=!0,o.push(n)),t(a).css("position","absolute")})),0<o.length&&this.container.find(".sgdg-loading").remove();var r=a(o,{containerWidth:this.container.find(".sgdg-gallery").width(),containerPadding:{top:10,left:0,right:0,bottom:0},boxSpacing:parseInt(sgdgShortcodeLocalize.grid_spacing),targetRowHeight:parseInt(sgdgShortcodeLocalize.grid_height),targetRowHeightTolerance:.15,edgeCaseMinRowHeight:0}),n=0;this.container.find(".sgdg-gallery").children().each((function(a,o){if(i[a]){var s=r.boxes[n],d=e.container.find(".sgdg-gallery").position();t(o).css("top",s.top+d.top),t(o).css("left",s.left+d.left),t(o).width(s.width),t(o).height(s.height),n++}else t(o).css("display","none")})),this.container.find(".sgdg-gallery").height(r.containerHeight)},o.prototype.reflowTimer=function(){var t=this;r.reflowAll(),this.loading&&setTimeout((function(){t.reflowTimer()}),250)},o.prototype.init=function(){var t=this.pathQueryParameter.get();this.path!==t&&(this.path=t,this.get())},o.prototype.get=function(){var i=this;this.path=this.pathQueryParameter.get(),this.lastPage=parseInt(this.pageQueryParameter.get())||1,this.lightbox=t().imageLightbox({allowedTypes:"",animationSpeed:parseInt(sgdgShortcodeLocalize.preview_speed,10),activity:"true"===sgdgShortcodeLocalize.preview_activity,arrows:"true"===sgdgShortcodeLocalize.preview_arrows,button:"true"===sgdgShortcodeLocalize.preview_closebutton,fullscreen:!0,history:!0,overlay:!0,caption:"true"===sgdgShortcodeLocalize.preview_captions,quitOnEnd:"true"===sgdgShortcodeLocalize.preview_quitOnEnd}),this.container.find(".sgdg-gallery").replaceWith('<div class="sgdg-loading"><div></div></div>'),this.container.find(".sgdg-more-button").remove(),r.reflowAll(),t.get(sgdgShortcodeLocalize.ajax_url,{action:"gallery",hash:this.hash,path:this.path,page:this.lastPage},(function(t){e(t)?i.container.html(t.error):i.getSuccess(t)}))},o.prototype.getSuccess=function(e){var i=this,a=((e.directories?e.directories.length:0)+(e.images?e.images.length:0)+(e.videos?e.videos.length:0))/this.lastPage,o="",r=1,n=a;(e.path&&0<e.path.length||0<e.directories.length)&&(o+=this.renderBreadcrumbs(e.path)),0<e.directories.length||0<e.images.length||0<e.videos.length?(o+='<div class="sgdg-loading"><div></div></div><div class="sgdg-gallery">',e.directories&&t.each(e.directories,(function(t,e){o+=i.renderDirectory(e),0===--n&&(n=a,r++)})),e.images&&t.each(e.images,(function(t,e){o+=i.renderImage(r,e),0===--n&&(n=a,r++)})),e.videos&&t.each(e.videos,(function(t,e){""!==document.createElement("video").canPlayType(e.mimeType)&&(o+=i.renderVideo(r,e)),0===--n&&(n=a,r++)})),o+="</div>",e.more&&(o+=this.renderMoreButton())):o+='<div class="sgdg-gallery">'+sgdgShortcodeLocalize.empty_gallery+"</div>",this.container.html(o),this.hasMore=e.more,this.postLoad(),this.lightbox.openHistory()},o.prototype.add=function(){var i=this;this.lastPage+=1,this.container.find(".sgdg-gallery").after('<div class="sgdg-loading"><div></div></div>'),this.container.find(".sgdg-more-button").remove(),t.get(sgdgShortcodeLocalize.ajax_url,{action:"page",hash:this.hash,path:this.pathQueryParameter.get(),page:this.lastPage},(function(t){if(e(t))return i.container.find(".sgdg-loading").replaceWith(t.error),void i.container.find(".sgdg-more-button").remove();i.addSuccess(t)}))},o.prototype.addSuccess=function(e){var i=this,a="";t.each(e.directories,(function(t,e){a+=i.renderDirectory(e)})),t.each(e.images,(function(t,e){a+=i.renderImage(i.lastPage,e)})),t.each(e.videos,(function(t,e){a+=i.renderVideo(i.lastPage,e)})),this.container.find(".sgdg-gallery").append(a),this.hasMore=e.more,e.more&&this.container.append(this.renderMoreButton()),this.container.find(".sgdg-loading").remove(),this.postLoad()},o.prototype.postLoad=function(){var e=this;this.container.find("a[data-sgdg-path]").off("click.sgdg").on("click.sgdg",(function(i){return history.pushState({},"",e.pathQueryParameter.add(t(i.currentTarget).data("sgdgPath"))),e.get(),!1})),this.container.find(".sgdg-more-button").click((function(){return e.add(),!1})),this.loading=!0,this.container.find(".sgdg-gallery").imagesLoaded({background:!0},(function(){e.loading=!1,r.reflowAll()})),this.reflowTimer(),this.lightbox.addToImageLightbox(this.container.find("a[data-imagelightbox]")),"true"===sgdgShortcodeLocalize.page_autoload&&t(window).off("scroll.sgdg").on("scroll.sgdg",(function(i){var a=t(".sgdg-more-button");undefined!==a.offset()&&(t(i.currentTarget).scrollTop()+t(window).height()>a.offset().top+a.outerHeight()&&!e.loading&&e.add())}))},o.prototype.renderBreadcrumbs=function(e){var i=this,a='<div><a data-sgdg-path="" href="'+this.pathQueryParameter.remove()+'">'+sgdgShortcodeLocalize.breadcrumbs_top+"</a>",o="";return t.each(e,(function(t,e){o+=e.id,a+=' > <a data-sgdg-path="'+o+'" href="'+i.pathQueryParameter.add(o)+'">'+e.name+"</a>",o+="/"})),a+="</div>"},o.prototype.renderDirectory=function(t){var e=this.pathQueryParameter.get(),i='<a class="sgdg-grid-a sgdg-grid-square" data-sgdg-path="'+(e=(e?e+"/":"")+t.id)+'" href="'+this.pathQueryParameter.add(e)+'"';if(t.thumbnail?i+=" style=\"background-image: url('"+t.thumbnail+"');\">":i+='><svg class="sgdg-dir-icon" x="0px" y="0px" focusable="false" viewBox="0 0 24 24" fill="#8f8f8f"><path d="M10 4H4c-1.1 0-2 .9-2 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"></path></svg>',i+='<div class="sgdg-dir-overlay"><div class="sgdg-dir-name">'+t.name+"</div>",t.dircount&&(i+='<span class="sgdg-count-icon dashicons dashicons-category"></span> '+t.dircount+(1e3===t.dircount?"+":"")),t.imagecount){var a="";t.dircount&&(a=" sgdg-count-icon-indent"),i+='<span class="sgdg-count-icon dashicons dashicons-format-image'+a+'"></span> '+t.imagecount+(1e3===t.imagecount?"+":"")}if(t.videocount){a="";(t.dircount||t.imagecount)&&(a=" sgdg-count-icon-indent"),i+='<span class="sgdg-count-icon dashicons dashicons-video-alt3'+a+'"></span> '+t.videocount+(1e3===t.videocount?"+":"")}return i+="</div></a>"},o.prototype.renderImage=function(t,e){return'<a class="sgdg-grid-a" data-imagelightbox="'+this.shortHash+'" data-ilb2-id="'+e.id+'" data-ilb2-caption="'+e.description+'" data-sgdg-page="'+t+'" href="'+e.image+'"><img class="sgdg-grid-img" src="'+e.thumbnail+'"></a>'},o.prototype.renderVideo=function(t,e){return'<a class="sgdg-grid-a" data-imagelightbox="'+this.shortHash+'" data-ilb2-id="'+e.id+'" data-sgdg-page="'+t+'" data-ilb2-video=\'{ "controls": "controls", "autoplay": "autoplay", "height": '+e.height+', "width": '+e.width+', "sources": [ { "src": "'+e.src+'", "type": "'+e.mimeType+'" } ] }\'><img class="sgdg-grid-img" src="'+e.thumbnail+'"></a>'},o.prototype.renderMoreButton=function(){return'<div class="sgdg-more-button"><div>'+sgdgShortcodeLocalize.load_more+"</div></div>"},o}(),r={shortcodes:{},init:function(){var e=this;t(".sgdg-gallery-container").each((function(i,a){var r=t(a).data("sgdgHash");r&&(e.shortcodes[r.substr(0,8)]=new o(a,r))})),t(document).on("start.ilb2 next.ilb2 previous.ilb2",(function(t,i){return e.onLightboxNavigation(i)})),t(document).on("quit.ilb2",(function(){return e.onLightboxQuit()}))},reflowAll:function(){t.each(this.shortcodes,(function(t,e){e.reflow()}))},onLightboxNavigation:function(e){var i=t(e).data("imagelightbox");this.shortcodes[i].onLightboxNavigation(e)},onLightboxQuit:function(){t.each(this.shortcodes,(function(t,e){e.onLightboxQuit()}))}};r.init()}));